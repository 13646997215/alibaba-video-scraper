<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>阿里巴巴商品视频爬虫工具</title>
    <link
      rel="icon"
      href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%23EABCDD"/><text x="50%25" y="56%25" dominant-baseline="middle" text-anchor="middle" font-size="34">🎬</text></svg>'
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="app-shell">
      <div class="bg-orb bg-orb-1"></div>
      <div class="bg-orb bg-orb-2"></div>

      <main class="container">
        <header class="hero-card">
          <div class="hero-badge">在线免费工具</div>
          <h1>🎬 阿里巴巴商品视频爬虫</h1>
          <p>粘贴商品链接，一键解析并打包下载全部视频</p>
          <div class="tag-row">
            <span class="tag">无需安装</span>
            <span class="tag">智能解析</span>
            <span class="tag">Vercel 全球访问</span>
          </div>
          <div class="hero-tools">
            <label class="theme-label" for="themeSelect">主题</label>
            <select id="themeSelect" class="filter-input compact-select">
              <option value="morandi">柔雾莫兰迪</option>
              <option value="dark-pro">深色商务</option>
              <option value="ocean-mist">海盐薄雾</option>
            </select>
            <button id="checkApiBtn" class="btn btn-soft" type="button">
              检测 API
            </button>
            <a class="btn btn-soft nav-link" href="diagnostics.html">诊断中心</a>
            <a class="btn btn-soft nav-link" href="help.html">使用帮助</a>
          </div>
        </header>

        <section class="card history-card" id="historyCard">
          <div class="history-header">
            <h2>历史标签</h2>
            <div class="history-actions-inline">
              <button id="clearHistoryBtn" class="btn btn-soft" type="button">
                清空历史
              </button>
              <button id="exportHistoryBtn" class="btn btn-soft" type="button">
                导出历史
              </button>
              <button id="importHistoryBtn" class="btn btn-soft" type="button">
                导入历史
              </button>
              <input
                id="importHistoryInput"
                type="file"
                accept="application/json"
                hidden
              />
            </div>
          </div>
          <input
            id="historySearchInput"
            class="filter-input"
            type="text"
            placeholder="搜索历史标签/链接/备注..."
          />
          <div id="historyTabs" class="history-tabs"></div>
          <div class="history-editor">
            <input
              id="historyLabelInput"
              class="filter-input"
              type="text"
              placeholder="标签名（可选）"
            />
            <input
              id="historyNoteInput"
              class="filter-input"
              type="text"
              placeholder="备注（可选）"
            />
            <div class="history-editor-actions">
              <button
                id="saveHistoryMetaBtn"
                class="btn btn-soft"
                type="button"
              >
                保存标签信息
              </button>
              <button id="pinHistoryBtn" class="btn btn-soft" type="button">
                置顶/取消置顶
              </button>
              <button id="deleteHistoryBtn" class="btn btn-soft" type="button">
                删除当前标签
              </button>
            </div>
          </div>
        </section>

        <section class="card input-card">
          <label class="field-label" for="urlInput">商品页面 URL</label>
          <div class="input-wrapper">
            <input
              type="text"
              id="urlInput"
              placeholder="https://www.alibaba.com/product-detail/..."
              class="url-input"
            />
            <button id="scrapeBtn" class="btn btn-primary">开始爬取</button>
          </div>
          <div class="quick-actions">
            <button id="clearUrlBtn" class="btn btn-soft" type="button">
              清空链接
            </button>
            <button id="pasteUrlBtn" class="btn btn-soft" type="button">
              粘贴链接
            </button>
            <button id="sampleUrlBtn" class="btn btn-soft" type="button">
              示例链接
            </button>
            <button id="formatUrlsBtn" class="btn btn-soft" type="button">
              格式化去重
            </button>
            <button id="copyInputBtn" class="btn btn-soft" type="button">
              复制输入
            </button>
            <button id="removeInvalidBtn" class="btn btn-soft" type="button">
              移除无效链接
            </button>
          </div>
          <p class="helper-text">
            支持阿里巴巴商品详情页，也支持多类资源网站链接。
            <span id="runtimeHint"></span>
            <span id="inputMeta"></span>
          </p>
        </section>

        <section class="card status-section" id="statusSection" hidden>
          <div class="status-header">
            <span class="status-icon" id="statusIcon">⏳</span>
            <div>
              <div class="status-text" id="statusText">正在处理...</div>
              <div class="status-message" id="statusMessage">
                正在获取页面...
              </div>
            </div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </section>

        <section class="card videos-section" id="videosSection" hidden>
          <div class="videos-header">
            <h2>解析结果</h2>
            <span class="count-pill" id="videoCountPill">0 个资源</span>
          </div>

          <div class="result-tools">
            <div class="tool-row">
              <select id="modeSelect" class="filter-input">
                <option value="video">视频模式（推荐）</option>
                <option value="all">
                  全资源模式（视频/图片/音频/文件/文件夹）
                </option>
              </select>
              <select id="sortSelect" class="filter-input">
                <option value="index">按原顺序</option>
                <option value="url">按链接字母序</option>
                <option value="length">按链接长度</option>
                <option value="type">按资源类型</option>
                <option value="domain">按域名</option>
              </select>
            </div>
            <div class="type-filter-panel" id="typeFilterPanel">
              <label class="type-option"
                ><input
                  type="checkbox"
                  class="type-filter"
                  value="video"
                  checked
                />视频</label
              >
              <label class="type-option"
                ><input
                  type="checkbox"
                  class="type-filter"
                  value="image"
                  checked
                />图片</label
              >
              <label class="type-option"
                ><input
                  type="checkbox"
                  class="type-filter"
                  value="audio"
                  checked
                />音频</label
              >
              <label class="type-option"
                ><input
                  type="checkbox"
                  class="type-filter"
                  value="file"
                  checked
                />文件</label
              >
              <label class="type-option"
                ><input
                  type="checkbox"
                  class="type-filter"
                  value="folder"
                  checked
                />文件夹</label
              >
              <label class="type-option"
                ><input
                  type="checkbox"
                  class="type-filter"
                  value="other"
                  checked
                />其他</label
              >
              <button id="typeAllBtn" class="btn btn-soft" type="button">
                类型全选
              </button>
              <button id="typeNoneBtn" class="btn btn-soft" type="button">
                类型清空
              </button>
            </div>
            <input
              id="filterInput"
              class="filter-input"
              type="text"
              placeholder="筛选链接关键字..."
            />
            <div class="tool-row">
              <input
                id="domainFilterInput"
                class="filter-input"
                type="text"
                placeholder="按域名筛选，例如 alibaba.com"
              />
              <input
                id="maxResultsInput"
                class="filter-input"
                type="number"
                min="0"
                step="1"
                placeholder="展示上限（0=不限）"
              />
            </div>
            <div class="toggle-row">
              <label class="type-option"
                ><input
                  id="selectedOnlyToggle"
                  type="checkbox"
                />仅显示已勾选</label
              >
              <label class="type-option"
                ><input
                  id="dedupeToggle"
                  type="checkbox"
                  checked
                />解析时去重</label
              >
              <button id="retryFailedBtn" class="btn btn-soft" type="button">
                重试失败链接
              </button>
            </div>
            <div class="tool-buttons">
              <button id="selectAllBtn" class="btn btn-soft" type="button">
                全选
              </button>
              <button id="invertSelectBtn" class="btn btn-soft" type="button">
                反选
              </button>
              <button id="deselectAllBtn" class="btn btn-soft" type="button">
                全不选
              </button>
              <button id="copyAllBtn" class="btn btn-soft" type="button">
                复制全部
              </button>
              <button id="copySelectedBtn" class="btn btn-soft" type="button">
                复制所选
              </button>
              <button id="copyFailedBtn" class="btn btn-soft" type="button">
                复制失败链接
              </button>
              <button id="openSelectedBtn" class="btn btn-soft" type="button">
                打开所选
              </button>
              <button id="exportJsonBtn" class="btn btn-soft" type="button">
                导出JSON
              </button>
              <button id="exportTxtBtn" class="btn btn-soft" type="button">
                导出TXT
              </button>
              <button id="exportCsvBtn" class="btn btn-soft" type="button">
                导出CSV
              </button>
              <button
                id="downloadSelectedBtn"
                class="btn btn-soft"
                type="button"
              >
                打包所选
              </button>
            </div>
          </div>

          <div id="resourceTypeStats" class="result-stats"></div>
          <div class="result-stats" id="resultStats"></div>
          <div class="videos-list" id="videosList"></div>
        </section>
      </main>

      <button id="downloadAllBtn" class="fab" title="打包下载全部资源" hidden>
        📦 打包下载全部
      </button>

      <div id="previewModal" class="preview-modal" hidden>
        <div class="preview-panel">
          <div class="preview-header">
            <strong>资源预览</strong>
            <button id="closePreviewBtn" class="btn btn-soft" type="button">
              关闭
            </button>
          </div>
          <video id="previewPlayer" controls class="preview-player"></video>
          <div id="previewUrl" class="preview-url"></div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
